<div class="container">

  @if (!isLoggedIn) {
    <div class="login-box">
      <h2>Únete al Chat</h2>
      <input [(ngModel)]="username" placeholder="Tu nombre de usuario...">
      <input [(ngModel)]="room" (keyup.enter)="joinChat()" placeholder="Nombre de la sala...">
      <button (click)="joinChat()">Unirse</button>
    </div>
  } @else {
    <div class="main-chat-container">

      <div class="chat-box">
        <h3 class="chat-header">
          <span>Sala: {{ room }}</span>
          <mat-slide-toggle [checked]="isDarkMode" (change)="toggleDarkMode()">
            Modo Oscuro
          </mat-slide-toggle>
        </h3>
        <ul class="message-list" #messageListContainer>
          @for (msg of messages; track $index) {
            <li class="message-item" [ngClass]="{
              'outgoing': msg.username === username,
              'incoming': msg.username && msg.username !== username,
              'notification': msg.type === 'notification'
            }">
              @if (msg.username && msg.username !== username) {
                <div class="message-author" [style.color]="getUsernameColor(msg.username)">
                  {{ msg.username }}
                </div>
              }
              <div class="message-text">{{ msg.text }}</div>

              @if(msg.type === 'message' && msg.createdAt) {
                <span class="message-timestamp">
                  {{ msg.createdAt | date:'shortTime' }}
                </span>
              }
            </li>
          }
        </ul>
        @if (typingUser) {
          <div class="typing-indicator">
            <em>{{ typingUser }} está escribiendo...</em>
          </div>
        }
        <div class="message-input">
          <input [(ngModel)]="newMessage" (input)="onTyping()" (keyup.enter)="sendMessage()" placeholder="Escribe un mensaje...">
          <button (click)="sendMessage()">Enviar</button>
        </div>
      </div>

      <div class="user-list-box">
        <h4>Usuarios Conectados</h4>
        <ul>
          @for (user of usersInRoom; track user) {
            <li [style.color]="getUsernameColor(user)">{{ user }}</li>
          }
        </ul>
      </div>

    </div>
  }

</div>
